<!DOCTYPE html>
<html style="height:100%;">
  <head>
    <meta charset="utf-8">
    <title>Enquadrados</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="css/google-material-icons.css">
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection">
    <link type="text/css" rel="stylesheet" href="css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  </head>
  <body style="height:100%;">
    <div class="navbar-fixed" style="height:100px;">
      <nav style="height:100px;">
        <div class="nav-wrapper" style="background-color: #414042">
          <ul id="nav-mobile">
            <li>
              <a class="valign-wrapper" href="#" style="height:100px;"><img class="valign" src="img/enquadrados-logo.svg" style="width:64px;"></a>
            </li>
            <li class="hide-on-med-and-down">
              <a class="valign-wrapper" href="#" style="height:100px; width:150px;"><p class="valign" style="margin:0 auto;">Ranking</p></a>
            </li>
            <li class="hide-on-med-and-down">
              <a class="valign-wrapper" href="#about_bottom" style="height:100px; width:150px;"><p class="valign" style="margin:0 auto;">Sobre</p></a>
            </li>
            <li class="hide-on-small-only right">
              <div class="valign-wrapper" style="height:100px;">
                <a id="search_button" class="valign waves-effect waves-light btn" style="background-color: #EF4136; height:60px;"><input id="city_search" class="autocomplete" type="text" placeholder="Busque sua cidade"><a class="dropdown-button" data-activates="city_search_dropdown" data-beloworigin="true" data-alignment="right" data-constrainwidth="false" style="display:gone;"></a></a><i class="material-icons left">search</i>
                <ul id="city_search_dropdown" class="dropdown-content">
                  <li><a href="#">Campina Grande</a></li>
                  <li><a href="#">Patos</a></li>
                  <li class="divider"></li>
                  <li><a href="#">João Pessoa</a></li>
                  <li><a href="#">Santa Rita</a></li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
      </nav>
    </div>
    <div class="row">
      <div class="col s4 valign-wrapper" style="height:500px; background-color:#EF4136;">
        <ul id="meters_squared_per_person" style="margin-left:20px; margin-right:20px;">
          <li>
            <h5 class="valign white-text" style="height:100px;">Mais metros quadrados por funcionário<br/><small class='valign white-text'>(m² / funcionário)</small><p class='valign white-text' style='font-size:10pt;'>Quanto cada funcionário teria de espaço para trabalhar?</p></h5>
          </li>
          <li><h5 class='valign'><a class='white-text hoverable' style='visibility:hidden; padding-left:20px; padding-right:20px;'>Carregando<small>...</small></a></h5></li>
          <li><h5 class='valign'><a class='white-text hoverable' style='visibility:hidden; padding-left:20px; padding-right:20px;'>Carregando<small>...</small></a></h5></li>
          <li><h5 class='valign'><a class='white-text hoverable' style='visibility:hidden; padding-left:20px; padding-right:20px;'>Carregando<small>...</small></a></h5></li>
          <li><h5 class='valign'><a class='white-text hoverable' style='visibility:hidden; padding-left:20px; padding-right:20px;'>Carregando<small>...</small></a></h5></li>
          <li><h5 class='valign'><a class='white-text hoverable' style='padding-left:20px; padding-right:20px;'>Carregando<small>...</small></a></h5></li>
        </ul>
      </div>
      <div class="col s4 valign-wrapper" style="height:500px; background-color:#7555A3;">
        <ul id="comissionados_por_total" style="margin-left:20px; margin-right:20px;">
          <li>
            <h5 class="valign white-text" style="height:100px;">Mais funcionários comissionados<br/><small>(comissionados / total)</small></h5>
          </li>
          <li><h5 class='valign'><a class='white-text hoverable' style='visibility:hidden; padding-left:20px; padding-right:20px;'>Carregando<small>...</small></a></h5></li>
          <li><h5 class='valign'><a class='white-text hoverable' style='visibility:hidden; padding-left:20px; padding-right:20px;'>Carregando<small>...</small></a></h5></li>
          <li><h5 class='valign'><a class='white-text hoverable' style='visibility:hidden; padding-left:20px; padding-right:20px;'>Carregando<small>...</small></a></h5></li>
          <li><h5 class='valign'><a class='white-text hoverable' style='visibility:hidden; padding-left:20px; padding-right:20px;'>Carregando<small>...</small></a></h5></li>
          <li><h5 class='valign'><a class='white-text hoverable' style='padding-left:20px; padding-right:20px;'>Carregando<small>...</small></a></h5></li>
        </ul>
      </div>
      <div class="col s4 valign-wrapper" style="height:500px; background-color:#5584A0;">
        <ul id="cargos_por_habitante" style="margin-left:20px; margin-right:20px;">
          <li>
            <h5 class="valign white-text" style="height:100px;">Mais funcionários por habitante<br/><small>(funcionários por mil hab.)</small></h5>
          </li>
          <li><h5 class='valign'><a class='white-text hoverable' style='visibility:hidden; padding-left:20px; padding-right:20px;'>Carregando<small>...</small></a></h5></li>
          <li><h5 class='valign'><a class='white-text hoverable' style='visibility:hidden; padding-left:20px; padding-right:20px;'>Carregando<small>...</small></a></h5></li>
          <li><h5 class='valign'><a class='white-text hoverable' style='visibility:hidden; padding-left:20px; padding-right:20px;'>Carregando<small>...</small></a></h5></li>
          <li><h5 class='valign'><a class='white-text hoverable' style='visibility:hidden; padding-left:20px; padding-right:20px;'>Carregando<small>...</small></a></h5></li>
          <li><h5 class='valign'><a class='white-text hoverable' style='padding-left:20px; padding-right:20px;'>Carregando<small>...</small></a></h5></li>
        </ul>
      </div>
    </div>
    <footer class="page-footer" style="background-color:#414041;">
      <div class="container">
	<div iclass="row">
	  <div class="col l6 s12">
            <h5 class="white-text" style="height:50px;">ENQUADRADOS</h5>
            <h6 class="white-text"><b>Sobre</b></h6>
            <p class="white-text">Com as eleições municipais chegando, que tal saber o perfil dos funcionários da Câmara Municipal da sua cidade? Será que o prédio consegue comportar a quantidade de funcionários contratados? Qual a relação de funcionários por metros quadrado do prédio? Esses funcionários são efetivos, eletivos ou comissionados? Este projeto foi desenvolvido no evento “Hackfest contra a corrupção”, uma parceria do laboratório Analytics, Ministério Público da Paraíba e a TV Paraíba.</p>
            <h6 id="about_bottom" class="white-text"><b>Dados</b></h6>
            <p class="white-text">As áreas de superfície das Câmaras Municipais foram calculadas através do Google Earth e consideram todo espaço interno dos prédios. A relação de funcionários, funções e tipos de contrato foram obtidos no banco de dados do <a href=https://sagres.tce.pb.gov.br/>SAGRES/PB</a>.</p>
	  </div>
	</div>
      </div>
      <div class="footer-copyright">
	<div class="container">
	<a class="grey-text text-lighten-4 right" href="https://www.facebook.com/analytics.ufcg?fref=ts">7o HackFest Analytics contra a Corrupção</a>
	</div>
      </div>
    </footer>
    <script type="text/javascript" src="js/jquery-3.1.0.min.js"></script>
    <script type="text/javascript" src="js/materialize.min.js"></script>
    <script type="text/javascript" src="js/mustache.min.js"></script>
    <script type="text/javascript" src="js/enquadrados.js"></script>
    <script type="application/javascript">
      $(document).ready(function() {
        $('select').material_select();
        $.ajax({
          type:'GET',
          url: 'http://localhost:8000/cidades/ranking/funcionario/area?format=json',
          data: {},
          success: function(data, status) {
            var top_five = [];
            var index = 0;
            for (entry in data["folhas"]) {
              if (index >= 5) {
                break;
              }
              var city_id = data["folhas"][entry]["cidade"]["id"];
              var city_name = data["folhas"][entry]["cidade"]["nome"];
              var area = parseFloat(data["folhas"][entry]["area"]);
              var workers_total = count_workers(data["folhas"][entry]["funcionarios"]);;
              top_five.push({ 'city_id': city_id, 'city_name': city_name, 'ratio': (area / workers_total).toFixed(2), 'position': ++index  });
            }
            var renderedList = Mustache.render("<li><h5 class='valign white-text' style='height:100px;'>Mais metros quadrados por funcionário<br/><small class='valign white-text'>(m² / funcionário)</small><p class='valign white-text' style='font-size:10pt;'>Quanto cada funcionário teria de espaço para trabalhar?</p></h5></li>{{#results}}<li><h5 class='valign'><a class='white-text hoverable' style='padding-left:20px; padding-right:20px;' href='/city.html?city_id={{city_id}}'>{{position}}. {{city_name}} <small>({{ratio}})</small></a></h5></li>{{/results}}", { 'results': top_five });
            $('#meters_squared_per_person').html(renderedList);
          }, error: function(jqXHR, textStatus, errorThrown) {
            console.log(errorThrown);
          }
        });
        $.ajax({
          type:'GET',
          url: 'http://localhost:8000/cidades/ranking/funcionario/percentual?format=json&nome_tipo=Comissionado',
          data: {},
          success: function(data, status) {
            var top_five = [];
            var index = 0;
            for (entry in data["folhas"]) {
              if (index >= 5) {
                break;
              }
              var city_id = data["folhas"][entry]["cidade"]["id"];
              var city_name = data["folhas"][entry]["cidade"]["nome"];
              var comissionados = data["folhas"][entry]["funcionarios"]['Comissionado']['quantidade'];
              var workers_total = count_workers(data["folhas"][entry]["funcionarios"]);
              top_five.push({ 'city_id': city_id, 'city_name': city_name, 'quantidade': comissionados, 'total' : workers_total, 'position': ++index  });
            }
            var renderedList = Mustache.render("<li><h5 class='valign white-text' style='height:100px;'>Mais funcionários comissionados<br/><small>(comissionados / total)</small></h5></li>{{#results}}<li><h5 class='valign'><a class='white-text hoverable' style='padding-left:20px; padding-right:20px;' href='/city.html?city_id={{city_id}}'>{{position}}. {{city_name}} <small>({{quantidade}} / {{total}})</small></a></h5></li>{{/results}}", { 'results': top_five });
            $('#comissionados_por_total').html(renderedList);
          }, error: function(jqXHR, textStatus, errorThrown) {
            console.log(errorThrown);
          }
        });
        $.ajax({
          type:'GET',
          url: 'http://localhost:8000/cidades/ranking/funcionario/populacao?format=json',
          data: {},
          success: function(data, status) {
            var top_five = [];
            var index = 0;
            for (entry in data["folhas"]) {
              if (index >= 5) {
                break;
              }
              var city_id = data["folhas"][entry]["cidade"]["id"];
              var city_name = data["folhas"][entry]["cidade"]["nome"];
              var populacao = data["folhas"][entry]["populacao"];
              var workers_total = count_workers(data["folhas"][entry]["funcionarios"]);
              top_five.push({ 'city_id': city_id, 'city_name': city_name, 'ratio': (1000 * workers_total / populacao).toFixed(2), 'total' : workers_total, 'position': ++index  });
            }
            var renderedList = Mustache.render("<li><h5 class='valign white-text' style='height:100px;'>Mais funcionários por habitante<br/><small>(funcionários por mil hab.)</small></h5></li>{{#results}}<li><h5 class='valign'><a class='white-text hoverable' style='padding-left:20px; padding-right:20px;' href='/city.html?city_id={{city_id}}'>{{position}}. {{city_name}} <small>({{ratio}})</small></a></h5></li>{{/results}}", { 'results': top_five });
            $('#cargos_por_habitante').html(renderedList);
          }, error: function(jqXHR, textStatus, errorThrown) {
            console.log(errorThrown);
          }
        });
        $.ajax({
          type:'GET',
          url: 'http://localhost:8000/cidades?format=json',
          data: {},
          success: function(cities_data, status) {
            $('#city_search').on("change", function() {
              var city_query = $('#city_search').val();
              var cities_found = [];
              for (city_data in cities_data) {
                var city_name = cities_data[city_data]["nome"];
                var city_id = cities_data[city_data]["id"];
                if (city_name.toLowerCase().includes(city_query.toLowerCase())) {
                  cities_found.push({ 'city_name': city_name, 'city_id': city_id });
                }
              }
              if (cities_found.length <= 0) {
                $('.dropdown-button').dropdown('close');
              } else {
                var renderedList = Mustache.render("{{#cities}}<li><a href='/city.html?city_id={{city_id}}'>{{city_name}}</a></li>{{/cities}}", { 'cities': cities_found });
                $('#city_search_dropdown').html(renderedList);
                $('.dropdown-button').dropdown('open');
              }
            });
          }, error: function(jqXHR, textStatus, errorThrown) {
            console.log(errorThrown);
          }
        });
      });
    </script>
  </body>
</html>
